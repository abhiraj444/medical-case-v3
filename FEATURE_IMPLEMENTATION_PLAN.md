# Feature Implementation Plan: Enhanced Content Generation

This document outlines the plan to implement the new features for the Content Generation module. The goal is to introduce a more interactive and controllable presentation creation process, from outline generation to slide management.

## 1. Feature Overview

The core idea is to change the existing "Generate Presentation" workflow into a two-step process:

1.  **Outline Generation**: Instead of directly creating a full presentation, the AI will first propose a structured outline of topics based on the initial clinical question and answer.
2.  **Selective Content Creation**: The user can then select topics from this outline to generate the actual presentation slides.

Additionally, the slide editor will be enhanced with robust "Add Section" and "Reorder Slides" functionalities.

## 2. Detailed Implementation Plan

### Step 1: Revamp the Initial Generation Flow

-   **UI Changes (`src/app/content-generator/page.tsx`)**:
    -   The existing **"Generate Presentation"** button will be removed.
    -   It will be replaced by a new button: **"Generate Presentation Outline"**.
-   **New AI Flow (`src/ai/flows/generate-presentation-outline.ts`)**:
    -   A new AI flow will be created to handle outline generation.
    -   **Input**: The clinical question, AI-generated answer, and reasoning.
    -   **Action**: The AI will be prompted to generate a structured list of topics and sub-topics suitable for a medical presentation. The first topic will explicitly be a summary of the question and answer.
    -   **Output**: A JSON array of topic strings (e.g., `["Q&A Summary and Analysis", "Pathophysiology of Condition X", "Standard Diagnostic Procedures", "Treatment Options"]`).
-   **Displaying the Outline**:
    -   A new UI component will be created to display the generated outline.
    -   Each topic will have a checkbox, allowing for multi-selection.
    -   A **"Generate Presentation"** button will appear below the outline, which will be enabled only when at least one topic is selected.

### Step 2: Content Generation from Outline

-   **Modified AI Flow (`src/ai/flows/generate-slide-outline.ts`)**:
    -   The existing flow for generating slide content will be modified.
    -   **New Input**: It will now accept the list of user-selected topics from the outline.
    -   **Action**: The AI prompt will be updated to generate detailed slides *only* for the topics provided. The logic for structuring slide content (paragraphs, lists, tables) will remain the same.
    -   The `SlideEditor` will then appear with the content for the selected topics, as it does now.

### Step 3: Enhance the `SlideEditor` Component

#### A. "Add Section" Functionality

-   Clicking the **"Add Section"** button will trigger a dialog/pop-up.
-   This dialog will present the user with two ways to add a new slide:
    1.  **Pre-defined Topics**: A list of suggested topics will be shown. This list will include:
        -   Topics from the initial outline that the user *did not* select.
        -   A few new, more technical/advanced topics generated by a separate, on-the-fly AI call.
    2.  **Custom Topic**: An input field will allow the user to type their own topic title.
-   Upon selecting or entering a topic, the `modifySlides` AI flow will be called to generate a new slide, which will be appended to the end of the current presentation.

#### B. "Reorder Slides" Functionality

-   I will integrate a lightweight drag-and-drop library (e.g., `dnd-kit`) into the `SlideEditor`.
-   Users will be able to drag and drop slides to change their order.
-   The underlying JSON array that stores the slide data will be updated in real-time to reflect the new order. This ensures that exports to PDF and Word documents maintain the user-defined structure.

### Step 4: Handling History and Data Persistence

-   **Firebase Integration**:
    -   The data saved to Firebase for a content generation case will be updated to include the generated outline and the final slides.
    -   The schema will look something like this:
        ```json
        {
          "userId": "...",
          "createdAt": "...",
          "type": "Content Generation",
          "question": "...",
          "answer": "...",
          "reasoning": "...",
          "outline": ["Topic 1", "Topic 2", ...],
          "slides": [{ "title": "...", "content": [...] }, ...]
        }
        ```
-   **Conditional UI Rendering**:
    -   When a user loads a case from the history page, the application will detect the presence of the `caseId`.
    -   If a `caseId` is present, the UI will **skip** the "Generate Presentation Outline" step.
    -   It will directly fetch the saved `slides` data from Firebase and render the `SlideEditor`, preserving the state of the presentation as it was saved.
    -   The "Add Section" functionality will still work, using the saved `outline` data to suggest topics.

This plan ensures that the new features are integrated smoothly into the existing application, align with the current UI/UX, and handle edge cases like viewing past work from the history section correctly.
